import{u as K}from"./exchange-rate.b68018fd.js";import{u as X,e as I,I as J,f as x,q as D,aj as G,s as H,ak as se,x as ce,E as U,P as ie,r as g,o as k,l as b,j as l,b as f,z as S,t as C,h as e,a as o,i as V,n as Q,w as ue,H as de,aa as ge,a5 as ve,c as pe,aC as he,y as me,aD as ye,aE as fe,aF as _e,F as xe,K as Ce}from"./main.a96be30f.js";import Ee from"./BaseTable.fb5b127e.js";const ke={class:"flex justify-between w-full"},$e=["onSubmit"],be={class:"px-4 md:px-8 py-8 overflow-y-auto sm:p-6"},Re={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid"},Be={setup(W){const{t:$}=X();let c=I(!1),u=I(!1),E=I(!1),h=I([]),v=I([]);const _=J(),t=K();let N=I([]);const z=x(()=>({currentExchangeRate:{key:{required:D.withMessage($("validation.required"),G(()=>!m.value))},driver:{required:D.withMessage($("validation.required"),H)},currencies:{required:D.withMessage($("validation.required"),H)}},currencyConverter:{type:{required:D.withMessage($("validation.required"),G(s))},url:{required:D.withMessage($("validation.required"),G(R)),url:D.withMessage($("validation.invalid_url"),se)}}})),j=x(()=>t.drivers.map(r=>Object.assign({},r,{key:$(r.key)}))),A=x(()=>_.active&&_.componentName==="ExchangeRateProviderModal");x(()=>_.title);const s=x(()=>t.currentExchangeRate.driver==="currency_converter"),m=x(()=>t.currentExchangeRate.driver==="nbkr"),R=x(()=>t.currencyConverter&&t.currencyConverter.type==="DEDICATED"),B=x(()=>{switch(t.currentExchangeRate.driver){case"nbkr":return"https://www.nbkr.kg";case"currency_converter":return"https://www.currencyconverterapi.com";case"currency_freak":return"https://currencyfreaks.com";case"currency_layer":return"https://currencylayer.com";case"open_exchange_rate":return"https://openexchangerates.org";default:return""}}),n=ce(z,x(()=>t));function F(){h.value=[]}function O(){const{currencies:r}=t.currentExchangeRate;h.value.forEach(a=>{r.forEach((p,y)=>{p===a&&r.splice(y,1)})}),h.value=[]}function i(){t.currentExchangeRate.key=null,t.currentExchangeRate.currencies=[],t.supportedCurrencies=[]}function M(){t.supportedCurrencies=[],v.value=[],t.currentExchangeRate={id:null,name:"",driver:"",key:"",active:!0,currencies:[]},t.currencyConverter={type:"",url:""},h.value=[]}async function Z(){t.currentExchangeRate.driver="currency_converter";let r={};t.isEdit&&(r.provider_id=t.currentExchangeRate.id),u.value=!0,await t.fetchDefaultProviders(),await t.fetchActiveCurrency(r),v.value=t.currentExchangeRate.currencies,u.value=!1}U(()=>s.value,(r,a)=>{r?re():t.currencyConverter={type:"",url:""}},{immediate:!0}),U(()=>t.currentExchangeRate.driver,(r,a)=>{r==="nbkr"&&q()}),U(()=>t.currentExchangeRate.key,(r,a)=>{r&&q()}),U(()=>{var r;return(r=t==null?void 0:t.currencyConverter)==null?void 0:r.type},(r,a)=>{r&&q()}),q=ie.exports.debounce(q,500);function ee(){return n.value.$touch(),ae(),!!(n.value.$invalid||h.value.length&&t.currentExchangeRate.active)}async function te(){if(ee())return!0;let r={...t.currentExchangeRate};m.value&&(r.key="no-key-required"),s.value&&(r.driver_config={...t.currencyConverter},R.value||(r.driver_config.url=""));const a=t.isEdit?t.updateProvider:t.addProvider;c.value=!0,await a(r).then(p=>{c.value=!1,_.refreshData&&_.refreshData(),P()}).catch(p=>{c.value=!1})}async function re(){let r=await t.getCurrencyConverterServers();N.value=r.data.currency_converter_servers,t.currencyConverter.type="FREE"}function q(){var p;const{driver:r,key:a}=t.currentExchangeRate;if(r&&(a||m.value)){E.value=!0;let y={driver:r,key:a||"no-key-required"};if(s.value&&!t.currencyConverter.type){E.value=!1;return}s.value&&((p=t==null?void 0:t.currencyConverter)==null?void 0:p.type)&&(y.type=t.currencyConverter.type),t.fetchCurrencies(y).then(w=>{E.value=!1}).catch(w=>{E.value=!1})}}function ae(r=!0){var p;h.value=[];const{currencies:a}=t.currentExchangeRate;a.length&&((p=t.activeUsedCurrencies)==null?void 0:p.length)&&a.forEach(y=>{t.activeUsedCurrencies.includes(y)&&h.value.push(y)})}function P(){_.closeModal(),setTimeout(()=>{M(),n.value.$reset()},300)}return(r,a)=>{const p=g("BaseIcon"),y=g("BaseMultiselect"),w=g("BaseInputGroup"),L=g("BaseInput"),T=g("BaseInfoAlert"),ne=g("BaseSwitch"),oe=g("BaseInputGrid"),Y=g("BaseButton"),le=g("BaseModal");return k(),b(le,{show:e(A),onClose:P,onOpen:Z},{header:l(()=>[f("div",ke,[S(C(e(_).title)+" ",1),o(p,{name:"XIcon",class:"w-6 h-6 text-gray-500 cursor-pointer",onClick:P})])]),default:l(()=>[f("form",{onSubmit:ue(te,["prevent"])},[f("div",be,[o(oe,{layout:"one-column"},{default:l(()=>[o(w,{label:r.$tc("settings.exchange_rate.driver"),"content-loading":e(u),required:"",error:e(n).currentExchangeRate.driver.$error&&e(n).currentExchangeRate.driver.$errors[0].$message,"help-text":e(B)},{default:l(()=>[o(y,{modelValue:e(t).currentExchangeRate.driver,"onUpdate:modelValue":[a[0]||(a[0]=d=>e(t).currentExchangeRate.driver=d),i],options:e(j),"content-loading":e(u),"value-prop":"value","can-deselect":!0,label:"key",searchable:!0,invalid:e(n).currentExchangeRate.driver.$error,"track-by":"key",onInput:a[1]||(a[1]=d=>e(n).currentExchangeRate.driver.$touch())},null,8,["modelValue","options","content-loading","invalid"])]),_:1},8,["label","content-loading","error","help-text"]),e(s)?(k(),b(w,{key:0,required:"",label:r.$t("settings.exchange_rate.server"),"content-loading":e(u),error:e(n).currencyConverter.type.$error&&e(n).currencyConverter.type.$errors[0].$message},{default:l(()=>[o(y,{modelValue:e(t).currencyConverter.type,"onUpdate:modelValue":[a[2]||(a[2]=d=>e(t).currencyConverter.type=d),i],"content-loading":e(u),"value-prop":"value",searchable:"",options:e(N),invalid:e(n).currencyConverter.type.$error,label:"value","track-by":"value"},null,8,["modelValue","content-loading","options","invalid"])]),_:1},8,["label","content-loading","error"])):V("",!0),e(m)?V("",!0):(k(),b(w,{key:1,label:r.$t("settings.exchange_rate.key"),required:"","content-loading":e(u),error:e(n).currentExchangeRate.key.$error&&e(n).currentExchangeRate.key.$errors[0].$message},{default:l(()=>[o(L,{modelValue:e(t).currentExchangeRate.key,"onUpdate:modelValue":a[3]||(a[3]=d=>e(t).currentExchangeRate.key=d),"content-loading":e(u),type:"text",name:"key",loading:e(E),"loading-position":"right",invalid:e(n).currentExchangeRate.key.$error},null,8,["modelValue","content-loading","loading","invalid"])]),_:1},8,["label","content-loading","error"])),e(m)?(k(),b(T,{key:2,class:"mt-2",title:r.$t("settings.exchange_rate.nbkr_free_api")},null,8,["title"])):V("",!0),e(t).supportedCurrencies.length?(k(),b(w,{key:3,label:r.$t("settings.exchange_rate.currency"),"content-loading":e(u),error:e(n).currentExchangeRate.currencies.$error&&e(n).currentExchangeRate.currencies.$errors[0].$message,"help-text":r.$t("settings.exchange_rate.currency_help_text")},{default:l(()=>[o(y,{modelValue:e(t).currentExchangeRate.currencies,"onUpdate:modelValue":a[4]||(a[4]=d=>e(t).currentExchangeRate.currencies=d),"content-loading":e(u),"value-prop":"code",mode:"tags",searchable:"",options:e(t).supportedCurrencies,invalid:e(n).currentExchangeRate.currencies.$error,label:"code","track-by":"code","open-direction":"top",onInput:a[5]||(a[5]=d=>e(n).currentExchangeRate.currencies.$touch())},null,8,["modelValue","content-loading","options","invalid"])]),_:1},8,["label","content-loading","error","help-text"])):V("",!0),e(R)?(k(),b(w,{key:4,label:r.$t("settings.exchange_rate.url"),"content-loading":e(u),error:e(n).currencyConverter.url.$error&&e(n).currencyConverter.url.$errors[0].$message},{default:l(()=>[o(L,{modelValue:e(t).currencyConverter.url,"onUpdate:modelValue":a[6]||(a[6]=d=>e(t).currencyConverter.url=d),"content-loading":e(u),type:"url",invalid:e(n).currencyConverter.url.$error,onInput:a[7]||(a[7]=d=>e(n).currencyConverter.url.$touch())},null,8,["modelValue","content-loading","invalid"])]),_:1},8,["label","content-loading","error"])):V("",!0),o(ne,{modelValue:e(t).currentExchangeRate.active,"onUpdate:modelValue":a[8]||(a[8]=d=>e(t).currentExchangeRate.active=d),class:"flex","label-right":r.$t("settings.exchange_rate.active")},null,8,["modelValue","label-right"])]),_:1}),e(h).length&&e(t).currentExchangeRate.active?(k(),b(T,{key:0,class:"mt-5",title:r.$t("settings.exchange_rate.currency_in_used"),lists:[e(h).toString()],actions:["Remove"],onHide:F,onRemove:O},null,8,["title","lists"])):V("",!0)]),f("div",Re,[o(Y,{class:"mr-3",variant:"primary-outline",type:"button",disabled:e(c),onClick:P},{default:l(()=>[S(C(r.$t("general.cancel")),1)]),_:1},8,["disabled"]),o(Y,{loading:e(c),disabled:e(c)||e(E),variant:"primary",type:"submit"},{left:l(d=>[e(c)?V("",!0):(k(),b(p,{key:0,name:"SaveIcon",class:Q(d.class)},null,8,["class"]))]),default:l(()=>[S(" "+C(e(t).isEdit?r.$t("general.update"):r.$t("general.save")),1)]),_:1},8,["loading","disabled"])])],40,$e)]),_:1},8,["show"])}}},we={slot:"header",class:"flex flex-wrap justify-between lg:flex-nowrap"},Ve={class:"text-lg font-medium text-left"},Ie={class:"mt-2 text-sm leading-snug text-left text-gray-500",style:{"max-width":"680px"}},Se={class:"mt-4 lg:mt-0 lg:ml-2"},De={class:"capitalize"},Me={class:"inline-block"},Ue={setup(W){const{tm:$,t:c}=X();de();const u=K(),E=J(),h=ge();let v=I("");const _=ve("utils"),t=x(()=>[{key:"driver",label:c("settings.exchange_rate.driver"),thClass:"extra",tdClass:"font-medium text-gray-900"},{key:"key",label:c("settings.exchange_rate.key"),thClass:"extra",tdClass:"font-medium text-gray-900"},{key:"active",label:c("settings.exchange_rate.active"),thClass:"extra",tdClass:"font-medium text-gray-900"},{key:"actions",label:"",tdClass:"text-right text-sm font-medium",sortable:!1}]);async function N({page:s,sort:m}){let R=Ce({orderByField:m.fieldName||"created_at",orderBy:m.order||"desc",page:s}),B=await u.fetchProviders(R);return{data:B.data.data,pagination:{totalPages:B.data.meta.last_page,currentPage:s,totalCount:B.data.meta.total,limit:5}}}function z(){E.openModal({title:c("settings.exchange_rate.new_driver"),componentName:"ExchangeRateProviderModal",size:"md",refreshData:v.value&&v.value.refresh})}function j(s){u.fetchProvider(s),E.openModal({title:c("settings.exchange_rate.edit_driver"),componentName:"ExchangeRateProviderModal",size:"md",data:s,refreshData:v.value&&v.value.refresh})}function A(s){h.openDialog({title:c("general.are_you_sure"),message:c("settings.exchange_rate.exchange_rate_confirm_delete"),yesLabel:c("general.ok"),noLabel:c("general.cancel"),variant:"danger",hideNoButton:!1,size:"lg"}).then(async m=>{m&&(await u.deleteExchangeRate(s),v.value&&v.value.refresh())})}return(s,m)=>{const R=g("BaseButton"),B=g("BaseBadge"),n=g("BaseDropdownItem"),F=g("BaseDropdown"),O=g("BaseCard");return k(),pe(xe,null,[o(Be),o(O,null,{default:l(()=>[f("div",we,[f("div",null,[f("h6",Ve,C(s.$t("settings.menu_title.exchange_rate")),1),f("p",Ie,C(s.$t("settings.exchange_rate.providers_description")),1)]),f("div",Se,[o(R,{variant:"primary-outline",size:"lg",onClick:z},{left:l(i=>[o(e(he),{class:Q(i.class)},null,8,["class"])]),default:l(()=>[S(" "+C(s.$t("settings.exchange_rate.new_driver")),1)]),_:1})])]),o(Ee,{ref:(i,M)=>{M.table=i,me(v)?v.value=i:v=i},class:"mt-16",data:N,columns:e(t)},{"cell-driver":l(({row:i})=>[f("span",De,C(i.data.driver.replace("_"," ")),1)]),"cell-active":l(({row:i})=>[o(B,{"bg-color":e(_).getBadgeStatusColor(i.data.active?"YES":"NO").bgColor,color:e(_).getBadgeStatusColor(i.data.active?"YES":"NO").color},{default:l(()=>[S(C(i.data.active?"YES":"NO"),1)]),_:2},1032,["bg-color","color"])]),"cell-actions":l(({row:i})=>[o(F,null,{activator:l(()=>[f("div",Me,[o(e(ye),{class:"w-5 text-gray-500"})])]),default:l(()=>[o(n,{onClick:M=>j(i.data.id)},{default:l(()=>[o(e(fe),{class:"h-5 mr-3 text-gray-600"}),S(" "+C(s.$t("general.edit")),1)]),_:2},1032,["onClick"]),o(n,{onClick:M=>A(i.data.id)},{default:l(()=>[o(e(_e),{class:"h-5 mr-3 text-gray-600"}),S(" "+C(s.$t("general.delete")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:1},8,["columns"])]),_:1})],64)}}};export{Ue as default};
